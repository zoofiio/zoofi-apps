(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2287],{79391:function(){},37031:function(e,t,n){Promise.resolve().then(n.bind(n,12434))},12434:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Dashboard}});var a=n(31113),s=n(95702),l=n(44939),o=n(75496),r=n(87031),u=n(44020),i=n(19757),c=n(22139),d=n(59175),p=n(31889),m=n(64103),v=n(51178);n(15506),n(66499);var f=n(26361),S=n(55349),y=n(83978),h=n.n(y),x=n(18358),b=n(84944);n(87763);var g=n(24378);let B=(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:(0,a.jsx)("circle",{cx:"7",cy:"7",r:"5",fill:"white",stroke:"#00DE9C",strokeWidth:"4"})}),k=(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",children:(0,a.jsx)("circle",{cx:"7",cy:"7",r:"5",fill:"white",stroke:"#FF3D3D",strokeWidth:"4"})});function DashItem(e){let{title:t,sub:n,tHeader:s,tData:l}=e;return(0,a.jsxs)("div",{className:"card whitespace-nowrap",children:["string"==typeof t?(0,a.jsx)("div",{className:"text-2xl leading-none font-semibold",children:t}):t,"string"==typeof n?(0,a.jsx)("div",{className:"text-[2rem] text-primary leading-none font-semibold mt-2",children:n}):n,(0,a.jsx)("div",{className:"my-4 h-[1px] bg-border/60 dark:bg-border"}),(0,a.jsx)("div",{className:"w-full overflow-x-auto",children:(0,a.jsx)(o.ZP,{headerClassName:"border-b-0",header:s,data:l})})]})}function TVLItem(){let e=function(){let e=(0,d.p)(),t=i.iK[e]||[],n=r.Fw[e].filter(e=>(e.onEnv||[]).includes(c.Vi)),{prices:a}=(0,m.useContext)(v.g),s=(0,S.o)(e=>e.sliceLVaultsStore.lvaults),l=(0,S.o)(e=>e.sliceTokenStore.totalSupply),o=t.map(e=>{var t;return(null===(t=s[e.vault])||void 0===t?void 0:t.usbTotalSupply)||0n}).reduce((e,t)=>e+t,0n),p=(0,S.o)(e=>e.sliceBVaultsStore.bvaults),f=(0,S.o)(e=>e.sliceTokenStore.prices),y=[].concat(t.map(e=>({name:e.xTokenSymbol+e.version,symbol:e.xTokenSymbol,address:e.xTokenAddress}))).map(e=>{let t=a[e.address],n=e.symbol==i.TW?o:l[e.address]||0n,s=t*n/c.Pq;return{...e,price:t,amount:n,usdAmount:s}}).concat(t.filter(e=>!e.isStable).map(e=>{let t=s[e.vault],n=((null==t?void 0:t.sellPoolTotalStaking)||0n)+((null==t?void 0:t.buyPoolBalance)||0n),l=a[e.assetTokenAddress],o=l*n/c.Pq;return{name:e.assetTokenSymbol+e.version,symbol:e.assetTokenSymbol,address:e.assetTokenAddress,price:l,amount:n,usdAmount:o}})).concat(h().chain(n).mapValues(e=>{let t=u.P[e.asset],n=p[e.vault],a=t&&n&&n.lpLiq&&n.lpBase&&n.lpQuote&&f[t.base]&&f[t.quote],s=a?(f[t.base]*n.lpBase+f[t.quote]*n.lpQuote)/n.lpLiq:f[e.asset]||c.Pq,l=(null==n?void 0:n.lpLiq)||(null==n?void 0:n.lockedAssetTotal)||0n;return{name:e.assetSymbol,symbol:e.assetSymbol,address:e.asset,price:s,amount:l,usdAmount:s*l/c.Pq}}).values().reduce((e,t)=>{let n=e.find(e=>e.symbol==t.symbol);return n?(n.amount+=t.amount,n.usdAmount+=t.usdAmount,e):[...e,t]},[]).value()),x=y.reduce((e,t)=>e+t.usdAmount,0n);return{tvl:x,tvlItems:y}}(),t=(0,m.useMemo)(()=>e.tvlItems.map(e=>[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:e.symbol,size:20}),(0,a.jsx)("span",{children:e.symbol})]},"icon"),"$".concat((0,b.d)(e.price)),(0,b.d)(e.amount),"$".concat((0,b.d)(e.usdAmount))]),[e.tvlItems]);return(0,a.jsx)(DashItem,{title:"Total Value Locked",sub:"$".concat((0,b.d)(e.tvl)),tHeader:["Asset","NAV","Amount","Total"],tData:t})}function LVaultsItem(){let e=(0,S.o)(e=>e.sliceLVaultsStore.lvaults,["sliceLVaultsStore.lvaults"]),t=(0,d.p)(),n=i.iK[t]||[],{prices:l}=(0,m.useContext)(v.g),o=(0,m.useMemo)(()=>n.map(t=>{var n,o,r,u,d;return[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:t.assetTokenSymbol,size:20}),(0,a.jsx)("span",{children:t.assetTokenSymbol})]},"icon"),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:t.assetTokenSymbol,size:14}),(0,a.jsx)("span",{children:(0,b.d)((null===(n=e[t.vault])||void 0===n?void 0:n.assetBalance)||0n)})]},"icon"),(0,a.jsxs)("div",{className:"opacity-60",children:["~",(0,b.d)((0,f.ok)(e[t.vault],"assetBalance")*l[t.assetTokenAddress]/c.Pq)]})]},"total"),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:i.TW,size:14}),(0,a.jsx)("span",{children:(0,b.d)((0,f.ok)(e[t.vault],"usbTotalSupply"))})]},"debt"),(0,f.Rr)((0,f.ok)(e[t.vault],"aar"),10n),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[1>=((null===(o=e[t.vault])||void 0===o?void 0:o.vaultMode)||0)?B:k,(0,a.jsx)("span",{children:1>=((null===(r=e[t.vault])||void 0===r?void 0:r.vaultMode)||0)?"Stability":"Adjustment"})]},"status"),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(null===(u=e[t.vault])||void 0===u?void 0:u.discountEnable)?k:B,(0,a.jsx)("span",{children:(null===(d=e[t.vault])||void 0===d?void 0:d.discountEnable)?"YES":"NO"})]},"discount")]}),[e,n,l]);return(0,a.jsx)(DashItem,{title:"L-Vault",tHeader:["Vaults","Total Deposit","".concat(i.TW," Debt"),"AAR","Status","Discount Offer"],tData:o})}function BVaultROI(e){let{vc:t}=e,{roi:n}=(0,g.tY)(t);return(0,a.jsx)(a.Fragment,{children:(0,f.Jh)(n,18,2)})}function BVaultsItem(){let e=(0,d.p)(),t=(0,m.useMemo)(()=>r.Fw[e].filter(e=>(e.onEnv||[]).includes(c.Vi)),[e]),n=(0,S.o)(e=>e.sliceBVaultsStore.bvaults,["sliceBVaultsStore.bvaults"]),l=(0,S.o)(e=>e.sliceTokenStore.prices,["sliceTokenStore.prices"]),o=(0,m.useMemo)(()=>{let e=t.map(e=>{let t=(0,f.ok)(n,[e.vault,"lockedAssetTotal"]),a=t*(0,f.ok)(l,[e.asset])/c.Pq,s=u.P[e.asset];if(s){let t=(0,f.ok)(n,[e.vault,"lpBase"]),o=(0,f.ok)(n,[e.vault,"lpQuote"]);a=(t*(0,f.ok)(l,[s.base])+o*(0,f.ok)(l,[s.quote]))/c.Pq}let[o,r]=s?e.assetSymbol.split("-"):["",""],i=Math.max(22+5*(0,b.d)(t).length,5*(0,b.d)(a).length+5);return{bvc:e,totalDeposit:t,totalDepositUsd:a,totalLeftWidth:i,lp:s,baseSymbol:o,quoteSymbol:r}}),o=e.reduce((e,t)=>Math.max(e,t.totalLeftWidth),0)+20;return e.map(e=>{let{bvc:t,totalDeposit:l,totalDepositUsd:r,lp:u,baseSymbol:i,quoteSymbol:c}=e;return[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:t.assetSymbol,size:20}),(0,a.jsx)("span",{children:t.assetSymbol})]},"icon"),(0,a.jsxs)("div",{className:"flex gap-8 items-start",children:[(0,a.jsxs)("div",{style:{width:o},children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:t.assetSymbol,size:14}),(0,a.jsx)("span",{children:(0,b.d)(l)})]},"icon"),(0,a.jsxs)("div",{className:"opacity-60",children:["~",(0,b.d)(r)]})]}),u&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:i,size:14}),(0,a.jsx)("span",{children:(0,b.d)((0,f.ok)(n,[t.vault,"lpBase"]))})]},"icon"),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(s.cL,{symbol:c,size:14}),(0,a.jsx)("span",{children:(0,b.d)((0,f.ok)(n,[t.vault,"lpQuote"]))})]},"icon")]})]},"total"),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[B,(0,a.jsxs)("span",{children:["Epoch ",(0,f.ok)(n,[t.vault,"epochCount"]).toString()]})]},"status"),(0,f.Jh)((0,x.lL)(t),10),(0,a.jsx)(BVaultROI,{vc:t},"roi")]})},[t,n,l]);return(0,a.jsx)(DashItem,{title:"B-Vault",tHeader:["Vaults","Total Deposit","Status","PT APY","YT ROI"],tData:o})}function Dashboard(){(0,p.a1)(),(0,p.Ev)();let e=(0,d.p)();return(0,a.jsx)(l.E,{children:(0,a.jsxs)("div",{className:"w-full max-w-[1200px] px-4 mx-auto flex flex-col gap-5 md:pb-8",children:[(0,a.jsx)(TVLItem,{}),80094!==e&&(0,a.jsx)(LVaultsItem,{}),(0,a.jsx)(BVaultsItem,{})]})})}},44939:function(e,t,n){"use strict";n.d(t,{E:function(){return PageWrap}});var a=n(31113),s=n(26361);n(64103);var l=n(12045);function PageWrap(e){let{children:t,className:n}=e;return(0,l.l)(e=>e.theme),(0,a.jsx)("div",{className:(0,s.cn)("h-auto pt-[30px] pb-6",n),children:t})}},75496:function(e,t,n){"use strict";var a=n(31113),s=n(26361);function DefEmpty(){return(0,a.jsx)("tr",{className:"text-lg font-normal text-center text-black ",children:(0,a.jsx)("td",{colSpan:100,className:"h-[100px] py-5 align-top"})})}n(64103),t.ZP=e=>{let{header:t,data:n,span:l={},empty:o=(0,a.jsx)(DefEmpty,{}),className:r="relative min-w-full bg-transparent ",headerClassName:u,headerItemClassName:i,tbodyClassName:c="",rowClassName:d,rowStyle:p,cellClassName:m,onClickRow:v,onRowMouseHover:f}=e;return(0,a.jsxs)("table",{className:(0,s.cn)("relative min-w-full bg-transparent ",r),children:[(0,a.jsx)("thead",{className:"",children:(0,a.jsx)("tr",{className:(0,s.cn)("text-left whitespace-nowrap font-normal text-black border-b border-gray-100 pt-5 pb-6 dark:text-slate-50 dark:border-zinc-600",u),children:t.map((e,t)=>(0,a.jsx)("th",{colSpan:l[t],scope:"col",className:(0,s.cn)(0==l[t]?"p-0 w-0":"p-3 font-normal text-sm",i),children:e},t))})}),(0,a.jsxs)("tbody",{className:(0,s.cn)(c),children:[n.map((e,n)=>(0,a.jsx)("tr",{onClick:()=>v&&v(n),onMouseEnter:()=>f&&f(n),onMouseLeave:()=>f&&f(-1),style:"function"==typeof p?p(n):p,className:(0,s.cn)("text-slate-700 dark:text-slate-50 font-medium whitespace-nowrap",v?"cursor-pointer hover:bg-slate-400/10":"","function"==typeof d?d(n):d),children:e.map((e,o)=>o>=t.length?(0,a.jsx)(a.Fragment,{children:e}):(0,a.jsx)("td",{colSpan:l[o],className:(0,s.cn)(0==l[o]?"p-0 w-max":"px-3 py-2 text-sm w-max","function"==typeof m?m(n,o):m),children:e},o))},n)),0===n.length&&o]})]})}},95889:function(e,t,n){"use strict";n.d(t,{EI:function(){return l},f_:function(){return r}});var a=n(51186),s=n(26361);let l=3,o={[a.F.id]:"0x31C410AEF663FEbDD7A2F1cCF0a4487CDcD56fdA"},r=(0,s.Yb)({[a.F.id]:[{vault:"0xEF14D1D8128f496f798f6721713D41070F17A727",asset:"0x2020cAB606cF79169A0f3F6Eb3E710326C4a4C1B",assetName:"Era NFT",assetSymbol:"ERA",assetLogo:"",vestingToken:"0xa10519209B4F6c8Ec22Fda6733a103D3e24F4C39",vestingSymbol:"MkRC20",vestingDecimals:18,vToken:"0x0A126144121Db990a066d63b02589D68104909cF",vTokenSymbol:"vERA",yTokenSymbol:"yERA",protocolAddress:"0x896774931349919B71Ec251CCbA1C6AB1FEb45C4",protocolSettingsAddress:"0xD91C388453042a2214Ad085df76A9E08Bc701f23",queryAddres:o[a.F.id],nftStakingPool:"0x73FA161A679020872356Eea8B6648F3D026228D1",onEnv:["test","prod"]}]},[])},24378:function(e,t,n){"use strict";n.d(t,{tY:function(){return useBvaultROI}});var a=n(66499),s=n(22139),l=n(22818),o=n(55349),r=n(18358),u=n(64370),i=n(83978),c=n.n(i),d=n(11292),p=n(35004),m=n(70283),v=n(4848),f=n(26361),S=n(59175);function calcRestakingApy(e,t,n){let a=t>0n?e*n/t:0n;return a>100n*s.Pq?0n:a}function calcAdditionalApy(e,t,n,a,l){let o=t>0n&&n>0n?t+n*a:0n,r=o>0n?e*s.Pq/o:0n,u=s.Pq*a,i=r*u/s.Pq,c=l>0n?i*s.Pq/l:0n;return c}function useBvaultROI(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0n,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0n,h=(0,r.nr)(e.vault),{data:x,isLoading:b}=(n=e.vault,(0,u.a)({initialData:0n,queryKey:["getReturnsIBGT",n],queryFn:async()=>{let e=await v.ZP.get("/api/bvault/getYieldiBGT/".concat(n)),t=BigInt(e.yield)/BigInt(e.dur);return t}})),{data:g,isLoading:B}=(0,m.x)(),k=h.current.duration+h.current.startTime,T=k>0n?k-BigInt(c().round(c().now()/1e3)):0n,w=h.current.yTokenAmountForSwapYT,V=w>0n?x*s.Pq*T/w:0n,A=(0,o.o)(e=>e.sliceTokenStore.prices["0xac03CABA51e17c86c921E1f6CBFBdC91F8BB2E6b"],["sliceTokenStore.prices.0xac03CABA51e17c86c921E1f6CBFBdC91F8BB2E6b"])||0n,P=(0,o.o)(e=>e.sliceTokenStore.prices,["sliceTokenStore.prices"])||0n,q=(0,r.Pd)(e.vault,e.asset);console.info("Prices:",e.assetSymbol,(0,d.d)(A),(0,d.d)(q));let E=h.current.vaultYTokenBalance,L=w+i>0n?x*s.Pq*T/(w+i):0n,j=E>0n?h.Y*s.Pq/E:0n,C=j*q/s.Pq,D=y*q/s.Pq,F=calcRestakingApy(V,C,A),U=i>0n?calcRestakingApy(L,D,A):0n;console.info("restakingapy:",e.assetSymbol,(0,d.d)(F),(0,d.d)(V),(0,d.d)(j),(0,d.d)(C));let N=null===(t=g["".concat(e.vault)])||void 0===t?void 0:t[parseInt(h.epochCount.toString())],M=N&&N.token&&N.amount?(0,f.ok)(P,m.c[N.token])*(0,p.f)(N.amount.toFixed(6))/s.Pq:0n,{data:I,isLoading:R}=function(e){let t=(0,r.nr)(e),n=(0,S.p)();return(0,u.a)({initialData:0n,gcTime:36e5,queryKey:["ytPoints",n,e,t.current.adhocBribesPool],enabled:!!e&&!!t.current.adhocBribesPool,queryFn:async()=>{let e=(0,l.B)(n);return e.readContract({abi:a.q3,address:t.current.adhocBribesPool,functionName:"totalSupply"})}})}(e.vault),Y=calcAdditionalApy(M,I,w,T,C),K=i>0n?calcAdditionalApy(M,I,w+i,T,D):0n,O=b||B||R;return{roi:!O&&w>0n&&V>0n?F+Y-s.Pq:0n,roiChange:!O&&w>0n&&V>0n?U+K-s.Pq:0n,restakingIncomesApy:F,additionalRoi:Y}}},70283:function(e,t,n){"use strict";n.d(t,{c:function(){return l},x:function(){return useGetAdditionalConfig}});var a=n(64370),s=n(83606);let l={BERA:"0x6969696969696969696969696969696969696969",HONEY:"0xFCBD14DC51f0A4d49d5E53C2E0950e0bC26d0Dce",USDC:"0x549943e04f40284185054145c6E4e9568C1D3241",BYUSD:"0x688e72142674041f8f6Af4c808a4045cA1D6aC82",WETH:"0x2F6F07CDcf3588944Bf4C42aC74ff24bF56e7590",iBGT:"0xac03CABA51e17c86c921E1f6CBFBdC91F8BB2E6b"};function useGetAdditionalConfig(){return(0,a.a)({initialData:{},gcTime:36e5,queryKey:["getAdditionalConfig"],queryFn:async()=>s.Z.get("https://raw.githubusercontent.com/zoofiio/configs/refs/heads/main/additional.json").then(e=>e.data)})}},31889:function(e,t,n){"use strict";n.d(t,{Ev:function(){return useLoadBVaults},a1:function(){return useLoadLVaults},g2:function(){return useLoadUserBVaults},tK:function(){return useLoadLntVaults},z2:function(){return useLoadUserLVaults}});var a=n(87031),s=n(19757),l=n(22139),o=n(55349),r=n(64370),u=n(83978),i=n.n(u),c=n(64103),d=n(96670),p=n(59175),m=n(95889),v=n(70283);function useLoadLVaults(){let e=(0,p.p)(),t=s.iK[e]||[],{address:n}=(0,d.m)(),a=(0,c.useMemo)(()=>i().chain(s.iK[e]||[]).map(e=>[e.assetTokenAddress,e.xTokenAddress]).flatten().concat([s.O1[e]]).union().value(),[e]);(0,r.a)({queryKey:["UpdateLvautlsTokens",a],queryFn:async()=>(await o.w.getState().sliceTokenStore.updateTokenTotalSupply(e,a),!0)}),(0,r.a)({queryKey:["UpdateUserLvautlsTokens",a,n],queryFn:async()=>!!n&&(await o.w.getState().sliceTokenStore.updateTokensBalance(e,a,n),!0)}),(0,r.a)({queryKey:["UpdateLVautls",t],queryFn:async()=>(await o.w.getState().sliceLVaultsStore.updateLVaults(e,t),!0)})}function useLoadBVaults(){let e=(0,p.p)(),t=(0,c.useMemo)(()=>a.Fw[e].filter(e=>(e.onEnv||[]).includes(l.Vi)),[e,l.Vi]),{isLoading:n}=(0,r.a)({queryKey:["UpdateBVaults",t],queryFn:async()=>(await Promise.all([o.w.getState().sliceBVaultsStore.updateBvaults(e,t),o.w.getState().sliceBVaultsStore.updateYTokenSythetic(e,t)]),!0)}),{address:s}=(0,d.m)(),u=(0,c.useMemo)(()=>t.map(e=>[e.asset,e.pToken]).flat().reduce((e,t)=>e.includes(t)?e:[...e,t],[]),[t]),{isLoading:i}=(0,r.a)({queryKey:["UpdateBvautlsTokens",u],queryFn:async()=>(await Promise.all([o.w.getState().sliceTokenStore.updateTokenTotalSupply(e,u),o.w.getState().sliceTokenStore.updateTokenPrices(e,u)]),!0),throwOnError:(e,t)=>(console.error(e),!1)}),{isLoading:m}=(0,r.a)({queryKey:["UpdateUserBvautlsTokens",u,s],queryFn:async()=>!!s&&(await o.w.getState().sliceTokenStore.updateTokensBalance(e,u,s),!0)}),{isLoading:f}=(0,v.x)();return{loading:n||i||m||f}}function useLoadLntVaults(){let e=(0,p.p)(),t=(0,c.useMemo)(()=>{var t;return(null===(t=m.f_[e])||void 0===t?void 0:t.filter(e=>(e.onEnv||[]).includes(l.Vi)))||[]},[e,l.Vi]);(0,r.a)({queryKey:["UpdateLntVaults",t],queryFn:async()=>(await o.w.getState().sliceLntVaultsStore.updateLntVaults(e,t),!0)});let{address:n}=(0,d.m)(),a=(0,c.useMemo)(()=>t.map(e=>[e.vestingToken,e.vToken]).flat().reduce((e,t)=>e.includes(t)?e:[...e,t],[]),[t]);(0,r.a)({queryKey:["UpdateLntvautlsTokens",a],queryFn:async()=>(await o.w.getState().sliceTokenStore.updateTokenTotalSupply(e,a),await o.w.getState().sliceTokenStore.updateTokenPrices(e,a),!0),throwOnError:(e,t)=>(console.error(e),!1)}),(0,r.a)({queryKey:["UpdateUserLntvautlsTokens",a,n],queryFn:async()=>!!n&&(await o.w.getState().sliceTokenStore.updateTokensBalance(e,a,n),!0)})}function useLoadUserLVaults(){let{address:e}=(0,d.m)(),t=(0,p.p)(),n=s.iK[t]||[];(0,r.a)({queryKey:["UpdateAllUserLVaults",t,e,n],queryFn:async()=>!!e&&(await Promise.all(n.map(n=>o.w.getState().sliceLVaultsStore.updateUserLVault(t,n,e))),!0)})}function useLoadUserBVaults(){let{address:e}=(0,d.m)(),t=(0,p.p)(),n=(0,c.useMemo)(()=>a.Fw[t].filter(e=>(e.onEnv||[]).includes(l.Vi)),[t,l.Vi]),s=(0,o.o)(e=>i().keys(e.sliceBVaultsStore.bvaults).toString(),["sliceBVaultsStore.bvaults"]);(0,r.a)({queryKey:["UpdateAllUserBvaults",n,t,e,s],queryFn:async()=>{if(!e)return!1;let a=o.w.getState().sliceBVaultsStore.bvaults;for(let e of n)if(!a[e.vault])return!1;await Promise.all(n.map(e=>o.w.getState().sliceBVaultsStore.updateEpoches(t,e)));let getEpochesParams=e=>{let t=o.w.getState().sliceBVaultsStore.bvaults[e.vault],n=[];for(let a=parseInt(t.epochCount.toString());a>0;a--){let t=o.w.getState().sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(a)];n.push(t)}return n};return await Promise.all(n.map(n=>o.w.getState().sliceUserBVaults.updateEpoches(t,n,e,getEpochesParams(n)))),!0}})}},88439:function(e,t,n){"use strict";n.d(t,{b:function(){return useMemoOfChainId}});var a=n(64103),s=n(59175);function useMemoOfChainId(e){let t=(0,s.p)(),n=(0,a.useRef)({});return(0,a.useMemo)(()=>(n.current[t]||(n.current[t]=e()),n.current[t]),[t])}},15506:function(e,t,n){"use strict";n.d(t,{D2:function(){return useWandContractRead},uX:function(){return useWandContractReads}}),n(22818);var a=n(83978),s=n.n(a);n(64103);var l=n(30308),o=n(59307),r=n(93108);n(59175);let u=(0,r.Ue)(e=>({time:s().now(),update:()=>{e({time:s().now()})}}));function useWandContractRead(e){let{time:t}=u();return(0,l.u)({...e,query:{placeholderData:e=>e,refetchOnMount:!1,refetchOnWindowFocus:!1,...e.query||{}},wandtime:t})}function useWandContractReads(e){let{time:t}=u();return(0,o.N)({...e,query:{placeholderData:e=>e,refetchOnMount:!1,refetchOnWindowFocus:!1,...e.query||{}},wandtime:t})}},51178:function(e,t,n){"use strict";n.d(t,{g:function(){return g},A:function(){return FetcherProvider}});var a=n(31113),s=n(19757),l=n(22139),o=n(59175),r=n(64103),u=n(25233),i=n(87958),c=n(41340),d=n(73216),p=n(88439),m=n(55349),v=n(33737),f=n(93108);let S=(0,f.Ue)(e=>({update:e}));var y=n(26361),h=n(64370),x=n(18358),b=n(39577);let g=(0,r.createContext)({prices:(0,y.Yb)({},0n),usbApr:{apr:0n,aprDecimals:10}}),FetcherProvider=e=>{let{children:t}=e;(0,x.d6)();let n=(0,o.p)();!function(){let{chainId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,u.m)({chainId:e});r.useMemo(()=>(t&&(d.ON.provider=function(e){var t,n;let{chain:a,transport:s}=e,l={chainId:a.id,name:a.name,ensAddress:null===(n=a.contracts)||void 0===n?void 0:null===(t=n.ensRegistry)||void 0===t?void 0:t.address};return"fallback"===s.type?new i.H(s.transports.map(e=>{let{value:t}=e;return new c.r(null==t?void 0:t.url,l)})):new c.r(s.url,l)}(t)),d.ON.provider),[t])}();let f=(0,p.b)(()=>(0,y.Yb)({[s.O1[n]]:l.Pq},0n));(0,b.$$)(f);let B=(0,b.UM)();return!function(e){let t=(0,o.p)(),n=s.iK[t]||[],a=(0,m.o)(e=>e.sliceLVaultsStore.lvaults,["sliceLVaultsStore.lvaults"]);(0,r.useEffect)(()=>{console.info("updatePtypoolApy"),null==n||n.forEach(n=>{let o=a[n.vault];if(n.ptyPoolAboveAddress&&o&&o.sellPoolTotalStaking&&S.getState().update({[n.ptyPoolAboveAddress]:{staking:(0,v.v)("0.025",10),matching:0n}}),n.ptyPoolBelowAddress&&o&&o.buyPoolTotalStaking&&!o.isStable){let a=o&&o.sellPoolTotalStaking*e[s.O1[t]],r=a>0n&&o.settingsDecimals>0n?o.M_ETHx*o.Y*e[n.xTokenAddress]*l.Pq/2n/a/o.settingsDecimals**10n:0n;S.getState().update({[n.ptyPoolBelowAddress]:{staking:r*10n**10n/l.Pq,matching:0n}})}})},[n,a,e,t])}(f),(0,h.a)({queryKey:["updateDefTokenList",n],staleTime:36e5,queryFn:async()=>(await m.w.getState().sliceTokenStore.updateDefTokenList(n),!0)}),(0,a.jsx)(g.Provider,{value:{prices:f,usbApr:B},children:t})}},18358:function(e,t,n){"use strict";n.d(t,{Pd:function(){return calcLPPrice},R3:function(){return useUpBVaultForUserAction},Vw:function(){return useEpochesData},Zd:function(){return useBVaultEpoches},d6:function(){return useResetBVaultsData},gz:function(){return useCalcClaimable},lL:function(){return calcBVaultPTApy},nr:function(){return useBVault},oU:function(){return useBVaultApy},v7:function(){return useBVaultBoost}});var a=n(22139),s=n(59175),l=n(26361),o=n(84944),r=n(83978),u=n.n(r),i=n(64103),c=n(96670),d=n(55349),p=n(44020);function useResetBVaultsData(){let e=(0,s.p)(),{address:t}=(0,c.m)();(0,i.useEffect)(()=>{},[e]),(0,i.useEffect)(()=>{d.w.getState().sliceUserBVaults.reset()},[t])}function useBVault(e){return(0,d.o)(t=>t.sliceBVaultsStore.bvaults[e]||(0,l.Yb)({current:(0,l.Yb)({},0n)},0n),["sliceBVaultsStore.bvaults.".concat(e)])}function useBVaultEpoches(e){return(0,d.o)(t=>{let n=t.sliceBVaultsStore.bvaults[e];if(!n||n.epochCount<=0n)return[];let a=u().range(1,parseInt((n.epochCount+1n).toString())).reverse(),s=t.sliceBVaultsStore.epoches;return a.map(t=>s["".concat(e,"_").concat(t)]).filter(e=>null!=e)},["sliceBVaultsStore.bvaults.".concat(e),"sliceBVaultsStore.epoches"])}function useEpochesData(e){let t=useBVaultEpoches(e),n=(0,d.o)(t=>t.sliceUserBVaults.epoches[e]||[],["sliceUserBVaults.epoches.".concat(e)]);return(0,i.useMemo)(()=>{let e=n.reduce((e,t)=>({...e,[t.epochId.toString()]:t}),{});return t.map(t=>(0,l.Yb)({...t,...e[t.epochId.toString()]||{bribes:[],sBribes:[],aBribes:[]}},0n))},[t,n])}function useCalcClaimable(e){let t=useEpochesData(e),n=useBVault(e);return(0,i.useMemo)(()=>{let e=t.filter(e=>e.claimableAssetBalance>10n&&(e.settled||n.closed));return{ids:e.map(e=>e.epochId),claimable:e.reduce((e,t)=>e+t.claimableAssetBalance,0n)}},[t,n.closed])}function useBVaultBoost(e){let t=(0,d.o)(()=>(function(e){let t=d.w.getState(),n=t.sliceBVaultsStore.bvaults[e],s=(null==n?void 0:n.current.vaultYTokenBalance)||0n,l=(null==n?void 0:n.Y)||0n,r=l>0n?s*a.Pq/l:0n,u=(null==n?void 0:n.current.yTokenAmountForSwapYT)||0n,i=(null==n?void 0:n.lockedAssetTotal)||0n,c=u>0n?i*a.Pq/u:0n;return console.info("calcBootst:",(0,o.d)(r),(0,o.d)(c)),r})(e),["sliceBVaultsStore.bvaults.".concat(e)]);return[(0,o.d)(t,0),t]}function calcBVaultPTApy(e){let t=d.w.getState(),n=t.sliceBVaultsStore.bvaults[e.vault],s=function(e){let t=d.w.getState(),n=t.sliceBVaultsStore.bvaults[e.vault],a=(0,l.ok)(t.sliceBVaultsStore.yTokenSythetic,[e.vault]);return 0n==a&&(a=(0,l.ok)(t.sliceTokenStore.totalSupply,e.pToken)*((null==n?void 0:n.current.duration)||0n)),a}(e),o=0n;return o=e.pTokenV2?n&&n.ptRebaseRate&&n.pTokenTotal?n.ptRebaseRate/a.Pq*a.SH*BigInt(1e10)/n.pTokenTotal/a.Pq:0n:n&&n.current.assetTotalSwapAmount&&s?n.current.assetTotalSwapAmount*a.SH*BigInt(1e10)/s:0n,console.info("apy:",e.vault,o,e.pTokenV2,null==n?void 0:n.ptRebaseRate,null==n?void 0:n.pTokenTotal,s),o}function useBVaultApy(e){let t=(0,d.o)(()=>calcBVaultPTApy(e),["sliceBVaultsStore.bvaults.".concat(e.vault),"sliceBVaultsStore.yTokenSythetic.".concat(e.vault)]);return[(0,l.Jh)(t,10),t]}function useUpBVaultForUserAction(e,t){let{address:n}=(0,c.m)(),a=(0,s.p)();return()=>{(0,l.XD)(async()=>{if(null==t||t(),!n)return;await Promise.all([d.w.getState().sliceTokenStore.updateTokensBalance(a,[e.asset,e.pToken],n),d.w.getState().sliceTokenStore.updateTokenTotalSupply(a,[e.asset,e.pToken]),d.w.getState().sliceBVaultsStore.updateBvaults(a,[e]),d.w.getState().sliceBVaultsStore.updateYTokenSythetic(a,[e])]);let s=d.w.getState().sliceBVaultsStore.bvaults[e.vault];await d.w.getState().sliceBVaultsStore.updateEpoches(a,e,s.epochCount>1n?[s.epochCount,s.epochCount-1n]:[s.epochCount]);let l=[];for(let t=parseInt(s.epochCount.toString());t>0;t--){let n=d.w.getState().sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(t)];l.push(n)}console.info("onUserAction:epoches",l),await d.w.getState().sliceUserBVaults.updateEpoches(a,e,n,l)},3,1e3)}}function calcLPPrice(e,t){let n=p.P[t];if(!n)return 0n;let a=d.w.getState().sliceBVaultsStore.bvaults[e];if(!a)return 0n;let s=d.w.getState().sliceTokenStore.prices,o=a.lpBase*(0,l.ok)(s,n.base,0n)+a.lpQuote*(0,l.ok)(s,n.quote);return a.lpLiq>0n?o/a.lpLiq:0n}},39577:function(e,t,n){"use strict";n.d(t,{$$:function(){return useSetLVaultPrices},UM:function(){return useUSBApr}});var a=n(19757),s=n(22139),l=n(59175);n(88439);var o=n(26361),r=n(55349);let u=(0,o.Yb)({vaultMode:0,discountEnable:!1},0n);function useSetLVaultPrices(e){var t;let n=(0,r.o)(e=>e.sliceLVaultsStore.lvaults),o=(0,r.o)(e=>e.sliceTokenStore.totalSupply),i=(0,l.p)();null===(t=a.iK[i])||void 0===t||t.forEach(t=>{let l=n[t.vault]||u,r=l.assetBalance,c=l.latestPrice,d=l.usbTotalSupply,p=o[t.xTokenAddress]||0n,m=p>0n&&r>0n&&c>0n&&d>0n&&r*c>d*s.Pq?(r*c-d*s.Pq)/p:0n;e[t.xTokenAddress]=m,e[t.assetTokenAddress]=c,p>0n&&r>0n&&c>0n&&d>0n&&r*c<d*s.Pq&&(e[a.O1[i]]=r*c/d)})}function useUSBApr(){var e;let t=(0,l.p)(),n=(0,r.o)(e=>e.sliceLVaultsStore.lvaults),s=0,o=0n,i=0n;return null===(e=a.iK[t])||void 0===e||e.forEach(e=>{let t=n[e.vault]||u;t.isStable?(o+=t.M_USB_USDC*t.Y*t.aar/10n**t.AARDecimals,i+=t.M_USB_USDC,t.M_USB_USDC>0n&&t.Y>0n&&s++):(o+=t.M_USB_ETH*t.Y,i+=t.M_USB_ETH,t.M_USB_ETH>0n&&t.Y>0n&&s++)}),{apr:i>0n?o/i:0n,aprDecimals:10}}(0,o.Yb)({},0n)}},function(e){e.O(0,[4881,7495,7622,4817,4173,3606,3204,9474,313,6499,9674,7093,604,1744],function(){return e(e.s=37031)}),_N_E=e.O()}]);