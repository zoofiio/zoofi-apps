(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5100],{79391:function(){},88439:function(e,t,n){"use strict";n.d(t,{b:function(){return useMemoOfChainId}});var u=n(64103),l=n(59175);function useMemoOfChainId(e){let t=(0,l.p)(),n=(0,u.useRef)({});return(0,u.useMemo)(()=>(n.current[t]||(n.current[t]=e()),n.current[t]),[t])}},15506:function(e,t,n){"use strict";n.d(t,{D2:function(){return useWandContractRead},uX:function(){return useWandContractReads}}),n(22818);var u=n(83978),l=n.n(u);n(64103);var a=n(30308),o=n(59307),s=n(93108);let r=(0,s.Ue)(e=>({time:l().now(),update:()=>{e({time:l().now()})}}));function useWandContractRead(e){let{time:t}=r();return(0,a.u)({...e,query:{placeholderData:e=>e,refetchOnMount:!1,refetchOnWindowFocus:!1,...e.query||{}},wandtime:t})}function useWandContractReads(e){let{time:t}=r();return(0,o.N)({...e,query:{placeholderData:e=>e,refetchOnMount:!1,refetchOnWindowFocus:!1,...e.query||{}},wandtime:t})}},51178:function(e,t,n){"use strict";n.d(t,{g:function(){return k},A:function(){return FetcherProvider}});var u=n(31113),l=n(19757),a=n(22139),o=n(59175),s=n(64103),r=n(25233),c=n(87958),i=n(41340),p=n(73216),d=n(88439),S=n(55349),f=n(33737),v=n(93108);let B=(0,v.Ue)(e=>({update:e}));var h=n(26361),V=n(64370),T=n(18358),b=n(39577);let k=(0,s.createContext)({prices:(0,h.Yb)({},0n),usbApr:{apr:0n,aprDecimals:10}}),FetcherProvider=e=>{let{children:t}=e;(0,T.d6)();let n=(0,o.p)();!function(){let{chainId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.m)({chainId:e});s.useMemo(()=>(t&&(p.ON.provider=function(e){var t,n;let{chain:u,transport:l}=e,a={chainId:u.id,name:u.name,ensAddress:null===(n=u.contracts)||void 0===n?void 0:null===(t=n.ensRegistry)||void 0===t?void 0:t.address};return"fallback"===l.type?new c.H(l.transports.map(e=>{let{value:t}=e;return new i.r(null==t?void 0:t.url,a)})):new i.r(l.url,a)}(t)),p.ON.provider),[t])}();let v=(0,d.b)(()=>(0,h.Yb)({[l.O1[n]]:a.Pq},0n));(0,b.$$)(v);let g=(0,b.UM)();return!function(e){let t=(0,o.p)(),n=l.iK[t]||[],u=(0,S.o)(e=>e.sliceLVaultsStore.lvaults,["sliceLVaultsStore.lvaults"]);(0,s.useEffect)(()=>{console.info("updatePtypoolApy"),null==n||n.forEach(n=>{let o=u[n.vault];if(n.ptyPoolAboveAddress&&o&&o.sellPoolTotalStaking&&B.getState().update({[n.ptyPoolAboveAddress]:{staking:(0,f.v)("0.025",10),matching:0n}}),n.ptyPoolBelowAddress&&o&&o.buyPoolTotalStaking&&!o.isStable){let u=o&&o.sellPoolTotalStaking*e[l.O1[t]],s=u>0n&&o.settingsDecimals>0n?o.M_ETHx*o.Y*e[n.xTokenAddress]*a.Pq/2n/u/o.settingsDecimals**10n:0n;B.getState().update({[n.ptyPoolBelowAddress]:{staking:s*10n**10n/a.Pq,matching:0n}})}})},[n,u,e,t])}(v),(0,V.a)({queryKey:["updateDefTokenList",n],staleTime:36e5,queryFn:async()=>(await S.w.getState().sliceTokenStore.updateDefTokenList(n),!0)}),(0,u.jsx)(k.Provider,{value:{prices:v,usbApr:g},children:t})}},18358:function(e,t,n){"use strict";n.d(t,{Pd:function(){return calcLPPrice},R3:function(){return useUpBVaultForUserAction},Vw:function(){return useEpochesData},Zd:function(){return useBVaultEpoches},d6:function(){return useResetBVaultsData},gz:function(){return useCalcClaimable},lL:function(){return calcBVaultPTApy},nr:function(){return useBVault},oU:function(){return useBVaultApy},v7:function(){return useBVaultBoost}});var u=n(22139),l=n(59175),a=n(26361),o=n(84944),s=n(83978),r=n.n(s),c=n(64103),i=n(96670),p=n(55349),d=n(44020);function useResetBVaultsData(){let e=(0,l.p)(),{address:t}=(0,i.m)();(0,c.useEffect)(()=>{},[e]),(0,c.useEffect)(()=>{p.w.getState().sliceUserBVaults.reset()},[t])}function useBVault(e){return(0,p.o)(t=>t.sliceBVaultsStore.bvaults[e]||(0,a.Yb)({current:(0,a.Yb)({},0n)},0n),["sliceBVaultsStore.bvaults.".concat(e)])}function useBVaultEpoches(e){return(0,p.o)(t=>{let n=t.sliceBVaultsStore.bvaults[e];if(!n||n.epochCount<=0n)return[];let u=r().range(1,parseInt((n.epochCount+1n).toString())).reverse(),l=t.sliceBVaultsStore.epoches;return u.map(t=>l["".concat(e,"_").concat(t)]).filter(e=>null!=e)},["sliceBVaultsStore.bvaults.".concat(e),"sliceBVaultsStore.epoches"])}function useEpochesData(e){let t=useBVaultEpoches(e),n=(0,p.o)(t=>t.sliceUserBVaults.epoches[e]||[],["sliceUserBVaults.epoches.".concat(e)]);return(0,c.useMemo)(()=>{let e=n.reduce((e,t)=>({...e,[t.epochId.toString()]:t}),{});return t.map(t=>(0,a.Yb)({...t,...e[t.epochId.toString()]||{bribes:[],sBribes:[],aBribes:[]}},0n))},[t,n])}function useCalcClaimable(e){let t=useEpochesData(e),n=useBVault(e);return(0,c.useMemo)(()=>{let e=t.filter(e=>e.claimableAssetBalance>10n&&(e.settled||n.closed));return{ids:e.map(e=>e.epochId),claimable:e.reduce((e,t)=>e+t.claimableAssetBalance,0n)}},[t,n.closed])}function useBVaultBoost(e){let t=(0,p.o)(()=>(function(e){let t=p.w.getState(),n=t.sliceBVaultsStore.bvaults[e],l=(null==n?void 0:n.current.vaultYTokenBalance)||0n,a=(null==n?void 0:n.Y)||0n,s=a>0n?l*u.Pq/a:0n,r=(null==n?void 0:n.current.yTokenAmountForSwapYT)||0n,c=(null==n?void 0:n.lockedAssetTotal)||0n,i=r>0n?c*u.Pq/r:0n;return console.info("calcBootst:",(0,o.d)(s),(0,o.d)(i)),s})(e),["sliceBVaultsStore.bvaults.".concat(e)]);return[(0,o.d)(t,0),t]}function calcBVaultPTApy(e){let t=p.w.getState(),n=t.sliceBVaultsStore.bvaults[e.vault],l=function(e){let t=p.w.getState(),n=t.sliceBVaultsStore.bvaults[e.vault],u=(0,a.ok)(t.sliceBVaultsStore.yTokenSythetic,[e.vault]);return 0n==u&&(u=(0,a.ok)(t.sliceTokenStore.totalSupply,e.pToken)*((null==n?void 0:n.current.duration)||0n)),u}(e),o=0n;return o=e.pTokenV2?n&&n.ptRebaseRate&&n.pTokenTotal?n.ptRebaseRate/u.Pq*u.SH*BigInt(1e10)/n.pTokenTotal/u.Pq:0n:n&&n.current.assetTotalSwapAmount&&l?n.current.assetTotalSwapAmount*u.SH*BigInt(1e10)/l:0n,console.info("apy:",e.vault,o,e.pTokenV2,null==n?void 0:n.ptRebaseRate,null==n?void 0:n.pTokenTotal,l),o}function useBVaultApy(e){let t=(0,p.o)(()=>calcBVaultPTApy(e),["sliceBVaultsStore.bvaults.".concat(e.vault),"sliceBVaultsStore.yTokenSythetic.".concat(e.vault)]);return[(0,a.Jh)(t,10),t]}function useUpBVaultForUserAction(e,t){let{address:n}=(0,i.m)(),u=(0,l.p)();return()=>{(0,a.XD)(async()=>{if(null==t||t(),!n)return;await Promise.all([p.w.getState().sliceTokenStore.updateTokensBalance(u,[e.asset,e.pToken],n),p.w.getState().sliceTokenStore.updateTokenTotalSupply(u,[e.asset,e.pToken]),p.w.getState().sliceBVaultsStore.updateBvaults(u,[e]),p.w.getState().sliceBVaultsStore.updateYTokenSythetic(u,[e])]);let l=p.w.getState().sliceBVaultsStore.bvaults[e.vault];await p.w.getState().sliceBVaultsStore.updateEpoches(u,e,l.epochCount>1n?[l.epochCount,l.epochCount-1n]:[l.epochCount]);let a=[];for(let t=parseInt(l.epochCount.toString());t>0;t--){let n=p.w.getState().sliceBVaultsStore.epoches["".concat(e.vault,"_").concat(t)];a.push(n)}console.info("onUserAction:epoches",a),await p.w.getState().sliceUserBVaults.updateEpoches(u,e,n,a)},3,1e3)}}function calcLPPrice(e,t){let n=d.P[t];if(!n)return 0n;let u=p.w.getState().sliceBVaultsStore.bvaults[e];if(!u)return 0n;let l=p.w.getState().sliceTokenStore.prices,o=u.lpBase*(0,a.ok)(l,n.base,0n)+u.lpQuote*(0,a.ok)(l,n.quote);return u.lpLiq>0n?o/u.lpLiq:0n}},39577:function(e,t,n){"use strict";n.d(t,{$$:function(){return useSetLVaultPrices},UM:function(){return useUSBApr}});var u=n(19757),l=n(22139),a=n(59175);n(88439);var o=n(26361),s=n(55349);let r=(0,o.Yb)({vaultMode:0,discountEnable:!1},0n);function useSetLVaultPrices(e){var t;let n=(0,s.o)(e=>e.sliceLVaultsStore.lvaults),o=(0,s.o)(e=>e.sliceTokenStore.totalSupply),c=(0,a.p)();null===(t=u.iK[c])||void 0===t||t.forEach(t=>{let a=n[t.vault]||r,s=a.assetBalance,i=a.latestPrice,p=a.usbTotalSupply,d=o[t.xTokenAddress]||0n,S=d>0n&&s>0n&&i>0n&&p>0n&&s*i>p*l.Pq?(s*i-p*l.Pq)/d:0n;e[t.xTokenAddress]=S,e[t.assetTokenAddress]=i,d>0n&&s>0n&&i>0n&&p>0n&&s*i<p*l.Pq&&(e[u.O1[c]]=s*i/p)})}function useUSBApr(){var e;let t=(0,a.p)(),n=(0,s.o)(e=>e.sliceLVaultsStore.lvaults),l=0,o=0n,c=0n;return null===(e=u.iK[t])||void 0===e||e.forEach(e=>{let t=n[e.vault]||r;t.isStable?(o+=t.M_USB_USDC*t.Y*t.aar/10n**t.AARDecimals,c+=t.M_USB_USDC,t.M_USB_USDC>0n&&t.Y>0n&&l++):(o+=t.M_USB_ETH*t.Y,c+=t.M_USB_ETH,t.M_USB_ETH>0n&&t.Y>0n&&l++)}),{apr:c>0n?o/c:0n,aprDecimals:10}}(0,o.Yb)({},0n)}}]);